/**
 * text-enhancer.js
 * Улучшение текста: синонимы, замена слов, обогащение лексики
 */

class TextEnhancer {
    constructor() {
        // Расширенный словарь синонимов с разными формами слов
        this.synonyms = {
            // Школьная тематика
            'школа': ['гимназия', 'лицей', 'учебное заведение', 'альма-матер', 'храм наук'],
            'школы': ['гимназии', 'лицея', 'учебного заведения'],
            'школе': ['гимназии', 'лицее', 'учебном заведении'],
            'школу': ['гимназию', 'лицей', 'учебное заведение'],
            'школой': ['гимназией', 'лицеем', 'учебным заведением'],
            
            'ученик': ['школьник', 'учащийся', 'воспитанник', 'гимназист', 'лицеист'],
            'ученика': ['школьника', 'учащегося', 'воспитанника', 'гимназиста'],
            'ученику': ['школьнику', 'учащемуся', 'воспитаннику', 'гимназисту'],
            'ученики': ['школьники', 'учащиеся', 'воспитанники', 'гимназисты'],
            'учеников': ['школьников', 'учащихся', 'воспитанников', 'гимназистов'],
            
            'учитель': ['педагог', 'преподаватель', 'наставник', 'воспитатель', 'ментор'],
            'учителя': ['педагога', 'преподавателя', 'наставника', 'воспитателя'],
            'учителю': ['педагогу', 'преподавателю', 'наставнику', 'воспитателю'],
            'учителей': ['педагогов', 'преподавателей', 'наставников', 'воспитателей'],
            
            'урок': ['занятие', 'классный час', 'лекция', 'семинар', 'практикум'],
            'урока': ['занятия', 'лекции', 'семинара'],
            'уроке': ['занятии', 'лекции', 'семинаре'],
            'уроки': ['занятия', 'лекции', 'семинары'],
            
            'класс': ['кабинет', 'аудитория', 'группа', 'коллектив', 'параллель'],
            'класса': ['кабинета', 'аудитории', 'группы', 'коллектива'],
            'классе': ['кабинете', 'аудитории', 'группе', 'коллективе'],
            
            // События
            'праздник': ['торжество', 'фестиваль', 'событие', 'мероприятие', 'гулянье'],
            'праздника': ['торжества', 'фестиваля', 'события', 'мероприятия'],
            'празднике': ['торжестве', 'фестивале', 'событии', 'мероприятии'],
            'праздником': ['торжеством', 'фестивалем', 'событием', 'мероприятием'],
            
            'концерт': ['выступление', 'представление', 'программа', 'фестиваль', 'гала-концерт'],
            'концерта': ['выступления', 'представления', 'программы'],
            'концерте': ['выступлении', 'представлении', 'программе'],
            
            'конкурс': ['соревнование', 'турнир', 'состязание', 'олимпиада', 'первенство'],
            'конкурса': ['соревнования', 'турнира', 'состязания'],
            'конкурсе': ['соревновании', 'турнире', 'состязании'],
            
            // Места
            'зал': ['аудитория', 'помещение', 'пространство', 'зала'],
            'зале': ['аудитории', 'помещении', 'пространстве'],
            'сцена': ['помост', 'эстрада', 'подмостки', 'арена'],
            'сцене': ['помосте', 'эстраде', 'подмостках', 'арене'],
            
            // Эмоции и оценки
            'хороший': ['отличный', 'прекрасный', 'замечательный', 'чудесный', 'великолепный', 'превосходный'],
            'хорошая': ['отличная', 'прекрасная', 'замечательная', 'чудесная', 'великолепная'],
            'хорошее': ['отличное', 'прекрасное', 'замечательное', 'чудесное', 'великолепное'],
            'хорошие': ['отличные', 'прекрасные', 'замечательные', 'чудесные', 'великолепные'],
            
            'плохой': ['неудачный', 'скверный', 'неудовлетворительный', 'посредственный'],
            'плохая': ['неудачная', 'скверная', 'неудовлетворительная', 'посредственная'],
            
            'большой': ['огромный', 'грандиозный', 'колоссальный', 'гигантский', 'масштабный'],
            'большая': ['огромная', 'грандиозная', 'колоссальная', 'гигантская'],
            'большое': ['огромное', 'грандиозное', 'колоссальное', 'гигантское'],
            'большие': ['огромные', 'грандиозные', 'колоссальные', 'гигантские'],
            
            'маленький': ['небольшой', 'крошечный', 'миниатюрный', 'малый', 'незначительный'],
            'маленькая': ['небольшая', 'крошечная', 'миниатюрная', 'малая'],
            'маленькие': ['небольшие', 'крошечные', 'миниатюрные', 'малые'],
            
            'красивый': ['прекрасный', 'великолепный', 'восхитительный', 'очаровательный', 'живописный'],
            'красивая': ['прекрасная', 'великолепная', 'восхитительная', 'очаровательная'],
            'красивое': ['прекрасное', 'великолепное', 'восхитительное', 'очаровательное'],
            'красивые': ['прекрасные', 'великолепные', 'восхитительные', 'очаровательные'],
            
            'интересный': ['увлекательный', 'захватывающий', 'занимательный', 'любопытный', 'интригующий'],
            'интересная': ['увлекательная', 'захватывающая', 'занимательная', 'любопытная'],
            'интересное': ['увлекательное', 'захватывающее', 'занимательное', 'любопытное'],
            'интересные': ['увлекательные', 'захватывающие', 'занимательные', 'любопытные'],
            
            'веселый': ['радостный', 'жизнерадостный', 'оживленный', 'задорный', 'игривый'],
            'веселая': ['радостная', 'жизнерадостная', 'оживленная', 'задорная'],
            'веселое': ['радостное', 'жизнерадостное', 'оживленное', 'задорное'],
            'веселые': ['радостные', 'жизнерадостные', 'оживленные', 'задорные'],
            
            'грустный': ['печальный', 'унылый', 'тоскливый', 'меланхоличный', 'безрадостный'],
            
            // Глаголы
            'прошел': ['состоялся', 'проведен', 'организован', 'проходил', 'был организован'],
            'прошла': ['состоялась', 'проведена', 'организована', 'проходила'],
            'прошло': ['состоялось', 'проведено', 'организовано', 'проходило'],
            'прошли': ['состоялись', 'проведены', 'организованы', 'проходили'],
            
            'организовали': ['провели', 'устроили', 'подготовили', 'осуществили', 'реализовали'],
            'подготовили': ['приготовили', 'разработали', 'составили', 'продумали'],
            
            'выступали': ['выступали', 'участвовали', 'показывали', 'демонстрировали'],
            'выступили': ['показали', 'представили', 'продемонстрировали'],
            
            'пели': ['исполняли', 'напевали', 'воспроизводили'],
            'танцевали': ['плясали', 'двигались', 'исполняли танцы'],
            
            'сказали': ['произнесли', 'вымолвили', 'проговорили', 'ответили', 'заметили'],
            'говорили': ['рассказывали', 'вещали', 'беседовали', 'общались'],
            
            'смотреть': ['глядеть', 'наблюдать', 'лицезреть', 'рассматривать', 'взирать'],
            'посмотрели': ['взглянули', 'оглядели', 'осмотрели', 'наблюдали'],
            
            'понравилось': ['пришлось по душе', 'вызвало восторг', 'впечатлило', 'тронуло'],
            
            // Наречия
            'очень': ['весьма', 'крайне', 'чрезвычайно', 'невероятно', 'необыкновенно'],
            'сильно': ['мощно', 'интенсивно', 'глубоко', 'основательно'],
            'быстро': ['стремительно', 'мгновенно', 'моментально', 'проворно', 'скоро'],
            'медленно': ['неспешно', 'неторопливо', 'плавно', 'размеренно'],
            'хорошо': ['отлично', 'прекрасно', 'замечательно', 'великолепно', 'превосходно'],
            'плохо': ['ужасно', 'скверно', 'неудовлетворительно', 'посредственно'],
            
            // Количества
            'много': ['немало', 'множество', 'обилие', 'масса', 'уйма'],
            'мало': ['немного', 'недостаточно', 'капля', 'чуть-чуть']
        };

        // Статистика замен для отладки
        this.stats = {
            totalWords: 0,
            replacedWords: 0,
            replacements: []
        };
    }

    /**
     * Улучшить текст с высокой интенсивностью
     */
    enhanceText(text, intensity = 0.7) { // Увеличили до 70%
        if (!text || text === '') {
            return '';
        }

        console.log(`Улучшаем текст с интенсивностью ${intensity}`);
        this.resetStats();

        // Разбиваем на слова и знаки препинания
        let words = this.splitIntoWords(text);
        this.stats.totalWords = words.length;
        
        // Проходим по каждому слову
        for (let i = 0; i < words.length; i++) {
            let word = words[i];
            
            // Пропускаем не-слова
            if (!this.isWord(word)) continue;
            
            // Очищаем от знаков препинания для поиска
            let cleanWord = this.cleanWord(word);
            let lowerWord = cleanWord.toLowerCase();
            
            // Проверяем, есть ли синонимы
            if (this.synonyms[lowerWord]) {
                // Заменяем с вероятностью intensity
                if (Math.random() < intensity) {
                    let replacement = this.getRandomSynonym(lowerWord);
                    
                    // Сохраняем регистр
                    if (this.isCapitalized(word)) {
                        replacement = this.capitalizeFirst(replacement);
                    }
                    
                    // Сохраняем знаки препинания
                    let punctuation = word.substring(cleanWord.length);
                    
                    console.log(`Замена: "${word}" -> "${replacement}${punctuation}"`);
                    this.stats.replacedWords++;
                    this.stats.replacements.push({
                        original: word,
                        replacement: replacement + punctuation
                    });
                    
                    words[i] = replacement + punctuation;
                }
            }
        }

        let result = words.join('');
        console.log(`Заменено ${this.stats.replacedWords} из ${this.stats.totalWords} слов`);
        
        return result;
    }

    /**
     * Получить случайный синоним
     */
    getRandomSynonym(word) {
        let synonyms = this.synonyms[word];
        if (!synonyms || synonyms.length === 0) return word;
        
        let randomIndex = Math.floor(Math.random() * synonyms.length);
        return synonyms[randomIndex];
    }

    /**
     * Сбросить статистику
     */
    resetStats() {
        this.stats = {
            totalWords: 0,
            replacedWords: 0,
            replacements: []
        };
    }

    /**
     * Получить статистику последней замены
     */
    getStats() {
        return this.stats;
    }

    // Вспомогательные методы (без изменений)
    splitIntoWords(text) {
        let words = [];
        let current = '';
        
        for (let i = 0; i < text.length; i++) {
            let c = text[i];
            if (this.isLetter(c)) {
                current += c;
            } else {
                if (current !== '') {
                    words.push(current);
                    current = '';
                }
                words.push(c);
            }
        }
        
        if (current !== '') {
            words.push(current);
        }
        
        return words;
    }

    cleanWord(word) {
        let clean = '';
        for (let i = 0; i < word.length; i++) {
            if (this.isLetter(word[i])) {
                clean += word[i];
            }
        }
        return clean;
    }

    isLetter(c) {
        let code = c.charCodeAt(0);
        if (code >= 1040 && code <= 1103) return true;
        if (code >= 65 && code <= 90) return true;
        if (code >= 97 && code <= 122) return true;
        if (code === 1025 || code === 1105) return true;
        return false;
    }

    isWord(str) {
        if (str.length === 0) return false;
        return this.isLetter(str[0]);
    }

    isCapitalized(word) {
        if (word.length === 0) return false;
        return this.isLetter(word[0]) && word[0] === word[0].toUpperCase();
    }

    capitalizeFirst(str) {
        if (str.length === 0) return str;
        return str[0].toUpperCase() + str.slice(1);
    }
}

// Создаем глобальный экземпляр
const textEnhancer = new TextEnhancer();